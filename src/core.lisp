(in-package :hylas)
(annot:enable-annot-syntax)

@document "Defines special forms and code language functions."

@doc "Please don't look at this code. Just don't. Please forgive me."
(defmacro extract (form (&rest bindings) &rest code)
  (let* ((str (make-string-output-stream))
         (bindings (loop for i from 0 to (1- (length bindings)) collecting
                     `((code (emit-code (nth ,i ,form) code))
                       (,(nth i bindings) (res code))
                       (,(read-from-string
                           (concatenate 'string
                             (symbol-name (nth i bindings)) "-type"))
                         (res-type code)))))
         (len (length bindings)))
    (format str "戾舄窿誉忾钿轭珞泔溴ㄤ雉轫弩ㄩ戾瞟黩轸瀛篝蜷铉篝颟蝈徜骝镯篝蜷铉ㄧ弭秕麴豸篝蝈犴篝蜷铉篝颟┅ㄤ彐疳蜥礤翦镳弪狒矧螵磲脲栳箬翎忪呼弩＇羼踽飑ㄤ彐疳蜥礤翦泔蝈磲脲栳箬翎忪呼弩＇羼踽飑ㄤ彐磲泸溴驸蹰祠轭翎忪钺礤蝈篝泔溴啜箦翩ㄧ弭栳箬ㄦ矧磲铋窿簌礅镬钺礤钺礤┅翎忪濠＇灬礅溽ㄦ矧泔溴楞镤濠┅ㄤ彐磲泸溴骘钺礤蝈篝泔溴啜溴驸蹰祠轭镳弪狒矧螵钺礤楞镤濠ㄤ彐磲泸溴驺矧钺礤蝈篝泔溴啜溴驸蹰祠轭泔蝈钺礤楞镤濠换轴蜷徕戾ㄤ彐镳溴戾è簌簌礅镬钺礤铘骘蝽┅┅ㄥ趄徙ㄣ潋骘蝽鲠祯濠ㄩ祜镫躔簌泔溴蜥轶骘蝽⒂礅镬璃犰蝈徜溴骈铄轭翳痱弩孱筱镳瀹簌愆痱镧鲠簌鲠鲠祯瀛豉疱┅ㄡ痧孱洵孱趄泔溴ㄡ篌殓ㄥ黹立簌愆蝈泔溴鲠祯瀛豉疱┅┅┅┅ㄤ彐镳珈镡犰ㄤ彐镳箦舂换旗秣蔑铘蝻ㄤ彐镳殒ㄥ趄徙骘蝽翦篝趄蹂怛犷汨驷祗瀛怛犷汨ㄩ铒ㄢ镲戾犷翦篝豉疱┅蜥轶骘蝽⒃桢豉疱镦翳翦篝屮痱弩箝镱麸ㄩ姗眭篝忮楸ㄢ镲戾犷┊ㄩ磲翥趄蹂怛犷汨豉疱驷祗瀛怛犷汨豉疱豁狒汨ㄡ痧孱洵孱趄泔溴ㄥ黹㈨蹊泔溴┅活磲翥蜥轶骘蝽⒃桢豉疱镦翳趄蹂犷驷祗怛犷汨弩眭篝磲翥琚┅┅｜ㄤ彐镳忮玳鏖翳铄鳝筱镳ㄥ趄徙舡扉篝┅换歪翳屙狒殂ㄤ彐磲泸珏铄蜷悱赭镝蜱镳镳啜屮趄徙骘蝽ㄦ轵篝箦泔钿ㄩ磲翥骈蝮舡豉疱箦泔钿豉疱ㄡ痧孱洵孱趄泔溴ㄡ篌殓蝈泔溴骈蝮舡豉疱ㄥ黹连立镳骈蝮舡豉疱骈蝮箦泔钿豉疱箦泔钿┅ㄥ蝌矧⒃疱眭篝磲翥琚┅┅ㄤ彐镳徜ㄧ孱弪殂赭镝蜱镳⑨滗┅ㄤ彐镳驷滗ㄧ孱弪殂赭镝蜱镳㈡徜洧┅ㄤ彐镳篚ㄧ孱弪殂赭镝蜱镳Ⅲ踱┅ㄤ彐镳骟踱ㄧ孱弪殂赭镝蜱镳㈡篚猗┅ㄤ彐镳眭ㄧ孱弪殂赭镝蜱镳㈨蹯┅ㄤ彐镳骓蹯ㄧ孱弪殂赭镝蜱镳㈡眭膦┅ㄤ彐镳蹁轹ㄧ孱弪殂赭镝蜱镳Ⅴ溟觫┅ㄤ彐镳箐轹ㄧ孱弪殂赭镝蜱镳Ⅲ溟觫┅ㄤ彐镳驿轹ㄧ孱弪殂赭镝蜱镳㈡溟觫┅ㄤ彐镳躜屙ㄧ孱弪殂赭镝蜱镳Ⅴ蝈恝┅ㄤ彐镳篁屙ㄧ孱弪殂赭镝蜱镳Ⅲ蝈恝┅｜ㄤ彐磲泸磲脲磲翳镳弪狒轱铙ī啜痱镧括祜镳骘镳弪狒矧轭Ж徜驷滗篚骟踱眭骓蹯蹁轹箐轹驿轹躜屙篁屙泔祆邈糸铉啜溴骘镳弪狒矧ㄧ孱弪殂赭镝蜱镳簌礅镬钺礤镳弪狒矧┅┅┅磲脲磲翳镳弪狒轱铙换麻赭轶橡弪狒轱铙ㄤ彐镳箬ㄧ孱弪殂赭镝蜱镳Ⅲ桁┅ㄤ彐镳祗栩ㄧ孱弪殂赭镝蜱镳㈧箬颌┅ㄤ彐镳狍栩ㄧ孱弪殂赭镝蜱镳⑨箬颌┅ㄤ彐镳忾舡犷ㄧ孱弪殂赭镝蜱镳⑨钿┅ㄤ彐镳忾舡矧ㄧ孱弪殂赭镝蜱镳矧┅ㄤ彐镳忾舡矧ㄧ孱弪殂赭镝蜱镳Ⅷ矧┅ㄤ彐镳怡翦篦狃ㄤ彐镳泔躅舡戾徜轭绛镱弩ㄤ彐镳泔躅舡趄衢扉铉镱弩ㄤ彐镳趄躅汜翦ㄤ彐镳屮翦钿ㄤ彐镳箦翦钿ㄤ彐镳屮翦钿换蔑铞弪箝镱ㄤ彐镳痿颦鹃铘ㄤ彐镳轭舡攫趄ㄤ彐镳忾翥狍舂ㄤ彐镳泔弪沐换麻翩殄熹箝ㄤ彐镳箝濠ㄤ彐镳徙趱犰箝濠换尼翎篝蝓泗躜弩ㄤ彐镳篝蝓泗躜濠ㄤ彐镳篝蝓泗铘瑭ㄤ彐镳篝蝓泗徙沐篌ㄤ彐镳磲脲狎蜥ㄤ彐镳珈镡犰狎蜥ㄤ彐镳铘璀狎蜥换湾盹蝙ㄤ彐镳礤憝犰祜汜翦ㄤ彐镳礤憝篝矧濠ㄤ彐镳礤憝祜徜ㄤ彐镳泸遽翦ㄤ彐镳蝈犰祜汜翦ㄤ彐镳溴篝蝻ㄤ彐镳徜潋弩螬换破ㄤ彐镳扉铍ㄤ彐镳骘蝈殓瞟换烫滞犷馏箦礅戾ㄤ彐镳狍愆ㄤ彐镳轭扉铄狍愆ㄤ彐镳烫滞ㄤ彐镳轭扉铄烫滞ㄤ彐疳蜥礤翦轭轸獒飙泔溴磲脲轭篝犷沐Ъ泔溴猴疱蜥麸蝮镳弪狒矧螵恒矧泔蝈┅